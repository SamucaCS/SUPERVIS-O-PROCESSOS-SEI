<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cadastro – Visitas e Apoio Presencial (Supervisor)</title>
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --muted: #94a3b8;
      --text: #e5e7eb;
      --accent: #22d3ee;
      --accent-2: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --radius: 16px
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      margin: 0
    }

    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans";
      background: linear-gradient(135deg, #0b1025 0%, #0f172a 40%, #0b2530 100%);
      color: var(--text);
      min-height: 100vh;
      padding: 24px
    }

    .container {
      max-width: 980px;
      margin: 0 auto
    }

    header {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 16px
    }

    h1 {
      font-size: 1.35rem;
      margin: 0
    }

    .card {
      background: linear-gradient(180deg, rgba(255, 255, 255, .04), rgba(0, 0, 0, .12));
      border: 1px solid rgba(255, 255, 255, .08);
      border-radius: var(--radius);
      box-shadow: 0 6px 24px rgba(0, 0, 0, .35);
      margin-bottom: 16px
    }

    form {
      padding: 16px
    }

    .grid {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(12, 1fr)
    }

    .col-6 {
      grid-column: span 6
    }

    .col-3 {
      grid-column: span 3
    }

    .col-12 {
      grid-column: span 12
    }

    @media (max-width:860px) {

      .col-6,
      .col-3 {
        grid-column: span 12
      }
    }

    label {
      display: block;
      font-size: .88rem;
      color: var(--muted);
      margin: 2px 0 6px
    }

    input,
    textarea {
      width: 100%;
      background: #0b1226;
      border: 1px solid rgba(255, 255, 255, .1);
      color: var(--text);
      padding: 12px;
      border-radius: 12px;
      outline: none
    }

    textarea {
      min-height: 70px;
      resize: vertical
    }

    .actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 10px
    }

    button {
      border: 0;
      cursor: pointer;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 700
    }

    .btn-primary {
      background: var(--accent);
      color: #03222c
    }

    .btn-secondary {
      background: #0b1226;
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, .15)
    }

    .ok {
      display: none;
      margin: 10px 16px 18px;
      color: #10b981
    }

    .links {
      display: flex;
      gap: 8px;
      align-items: center;
      margin: 6px 0 18px
    }

    a.btn {
      display: inline-block;
      text-decoration: none
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>Cadastro – Visitas e Apoio Presencial (Supervisor)</h1>
      <div class="links">
        <a class="btn btn-secondary" href="./supervisao-resultados.html">Ver resultados</a>
      </div>
    </header>

    <!-- VISITA / APOIO (mesma tabela) -->
    <section class="card" aria-labelledby="titulo-visitas">
      <form id="form-visitas">
        <h2 id="titulo-visitas" style="margin:0 0 8px;font-size:1rem">Nova visita/apoio</h2>
        <div class="grid">
          <div class="col-6">
            <label for="v-prof">Supervisor</label>
            <input id="v-prof" name="supervisor_nome" type="text" placeholder="Ex.: Ana Silva" required />
          </div>
          <div class="col-3">
            <label for="v-data">Data</label>
            <input id="v-data" name="data_visita" type="date" required />
          </div>
          <div class="col-3">
            <label for="v-escola">Escola</label>
            <input id="v-escola" name="escola" type="text" placeholder="Ex.: E.E. Alberto Santos" required />
          </div>
          <div class="col-12">
            <label for="v-tema">Tema</label>
            <input id="v-tema" name="tema" type="text" placeholder="Ex.: Visita técnica; Apoio em sala" required />
          </div>
          <div class="col-12">
            <label for="v-obs">Observações (opcional)</label>
            <textarea id="v-obs" name="observacoes" placeholder="Registre detalhes, encaminhamentos etc."></textarea>
          </div>
        </div>
        <div class="actions">
          <button type="submit" class="btn-primary">Adicionar</button>
          <button type="reset" class="btn-secondary">Limpar</button>
        </div>
        <p class="ok" id="ok-visitas">✓ Registro salvo.
          <a id="ok-link-visitas" class="btn btn-secondary" href="./supervisao-resultados.html">Ver resultados</a>
        </p>
      </form>
    </section>
  </div>

  <script>
    // ==== Supabase (PROJETO NOVO) ====
    const SUPABASE_URL = 'https://sfhxxkafubugqvaycnke.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNmaHh4a2FmdWJ1Z3F2YXljbmtlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3NTExMDEsImV4cCI6MjA3NzMyNzEwMX0.m7GJ-NVuouQsGdPTRGAx1bd6aPIP5-OWrdvoFTWSJU0';

    async function enviar(payload) {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/supervisor_submissions`, {
        method: 'POST',
        headers: {
          apikey: SUPABASE_ANON_KEY,
          Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
          'Content-Type': 'application/json',
          Prefer: 'return=representation'
        },
        body: JSON.stringify(payload)
      });
      const text = await res.text();
      let json; try { json = text ? JSON.parse(text) : null } catch { }
      if (!res.ok) throw new Error(json?.message || text || `HTTP ${res.status}`);
      return json;
    }

    function wireForm() {
      const form = document.getElementById('form-visitas');
      const ok = document.getElementById('ok-visitas');
      const okLink = document.getElementById('ok-link-visitas');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const fd = new FormData(form);

        const payload = {
          supervisor_nome: (fd.get('supervisor_nome') || '').toString().trim(),
          escola: (fd.get('escola') || '').toString().trim(),
          data_visita: (fd.get('data_visita') || '').toString(), // YYYY-MM-DD
          tema: (fd.get('tema') || '').toString().trim(),
          observacoes: (fd.get('observacoes') || '').toString().trim() || null
        };

        try {
          await enviar(payload);
          ok.style.display = 'block';
          okLink.focus();
          form.reset();
          setTimeout(() => ok.style.display = 'none', 3500);
        } catch (err) {
          alert('Falha ao enviar: ' + err.message);
        }
      });
    }

    wireForm();
  </script>
</body>

</html>
